<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Payroll SaaS Intelligence</title>
  <link rel="stylesheet" href="assets/styles.css">
  
  <style>
    /* Updates Feed Container */
    .updates-section {
        margin-top: 2rem;
        margin-bottom: 2rem;
    }

    /* Individual Update Card */
    .update-card {
        background: #ffffff;
        border: 1px solid #eee;
        border-left: 5px solid #007bff; /* Default Blue */
        padding: 1rem;
        margin-bottom: 0.75rem;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column; /* Stack on mobile, row on desktop */
        gap: 0.5rem;
    }

    @media (min-width: 768px) {
        .update-card {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }
    }

    /* Color Coding based on Type */
    .update-card.price-change { border-left-color: #dc3545; } /* Red */
    .update-card.new-vendor { border-left-color: #28a745; }   /* Green */
    .update-card.plan-update { border-left-color: #ffc107; }  /* Yellow */

    .update-meta {
        font-size: 0.85rem;
        color: #6b7280;
        min-width: 100px;
    }

    .update-content {
        flex-grow: 1;
    }

    .update-content h4 {
        margin: 0;
        font-size: 1.1rem;
        color: #111827;
    }

    .update-content p {
        margin: 0.25rem 0 0 0;
        color: #4b5563;
        font-size: 0.95rem;
    }

    .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        color: white;
        background-color: #007bff;
        text-transform: uppercase;
        width: fit-content;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="text-3xl font-bold text-gray-900"><span class="text-indigo-600">Payroll</span>Intel</h1>
      <nav>
        <a href="index.html">Home</a>
        <a href="benchmark.html">Benchmark</a>
        <a href="jobboard.html">Job Board</a>
        <a href="newsletter_template.md">Newsletter</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h2>Auto-updated pricing & feature benchmark for Payroll SaaS (India)</h2>
      <p>Weekly micro-intelligence packs Â· Live benchmark pages Â· Job board with featured posts</p>
      <p><a class="btn" href="benchmark.html">View Benchmark</a> <a class="btn ghost" href="jobboard.html">View Job Board</a></p>
    </section>

    <section class="updates-section">
      <h3>ðŸ”” Recent Market Updates</h3>
      <div id="changelog-container">
          <p style="color: #666; font-style: italic;">Loading intelligence feed...</p>
      </div>
    </section>

    <hr style="border: 0; border-top: 1px solid #eee; margin: 2rem 0;">

    <section>
      <h3>How it works</h3>
      <ol>
        <li>We collect vendor pages and news using Google Apps Script and summarize with OpenAI.</li>
        <li>Jobs are collected in Airtable and pulled nightly via GitHub Actions.</li>
        <li>Benchmark pages and job board are static and hosted on GitHub Pages.</li>
      </ol>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Built with automation. Customize for your niche. <a href="README.md">Read docs</a>.</p>
    </div>
  </footer>

  <script>
    async function loadChangelog() {
        const container = document.getElementById('changelog-container');
        
        try {
            // FIX 1: Add cache buster (?v=...) to prevent loading old data
            // FIX 2: Using 'changelog.json'. If this fails, change it to 'data/changelog.json'
            const response = await fetch('changelog.json?v=' + Date.now());
            
            if (!response.ok) {
                // Try the 'data/' folder if the root folder failed
                const fallbackResponse = await fetch('data/changelog.json?v=' + Date.now());
                if (fallbackResponse.ok) {
                     processData(await fallbackResponse.json(), container);
                     return;
                }
                throw new Error('File not found');
            }

            const data = await response.json();
            processData(data, container);

        } catch (error) {
            console.error('Error:', error);
            container.innerHTML = '<p style="text-align:center; color:#666;">Unable to load updates. (Check console for details)</p>';
        }
    }

    function processData(data, container) {
        container.innerHTML = ''; // Clear "Loading..." message

        if (!data || data.length === 0) {
            container.innerHTML = '<div class="update-card" style="text-align:center; color:#666;">No recent market changes detected.</div>';
            return;
        }

        // Show the 5 most recent updates
        data.slice(0, 5).forEach(update => {
            // Determine styling based on type
            let colorClass = 'plan-update'; // Default Yellow
            let icon = 'ðŸ“¢';

            if (update.type === 'Price Change') {
                colorClass = 'price-change'; // Red
                icon = 'ðŸ’°';
            } else if (update.type === 'New Vendor') {
                colorClass = 'new-vendor'; // Green
                icon = 'âœ¨';
            }

            const card = document.createElement('div');
            card.className = `update-card ${colorClass}`;
            card.innerHTML = `
                <div class="update-meta">
                    <div class="badge">${update.vendor}</div>
                    <div style="margin-top:0.5rem; font-size:0.8rem; color:#666;">${update.date}</div>
                </div>
                <div class="update-content">
                    <h4>${icon} ${update.type}</h4>
                    <p>${update.details}</p>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // FIX 3: Actually run the function when the page loads
    document.addEventListener('DOMContentLoaded', loadChangelog);
  </script>
</body>
</html>  
