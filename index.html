<script>
    async function loadChangelog() {
        const container = document.getElementById('changelog-container');
        
        try {
            // FIX 1: Add cache buster (?v=...) to prevent loading old data
            // FIX 2: Using 'changelog.json'. If this fails, change it to 'data/changelog.json'
            const response = await fetch('changelog.json?v=' + Date.now());
            
            if (!response.ok) {
                // Try the 'data/' folder if the root folder failed
                const fallbackResponse = await fetch('data/changelog.json?v=' + Date.now());
                if (fallbackResponse.ok) {
                     processData(await fallbackResponse.json(), container);
                     return;
                }
                throw new Error('File not found');
            }

            const data = await response.json();
            processData(data, container);

        } catch (error) {
            console.error('Error:', error);
            container.innerHTML = '<p style="text-align:center; color:#666;">Unable to load updates. (Check console for details)</p>';
        }
    }

    function processData(data, container) {
        container.innerHTML = ''; // Clear "Loading..." message

        if (!data || data.length === 0) {
            container.innerHTML = '<div class="update-card" style="text-align:center; color:#666;">No recent market changes detected.</div>';
            return;
        }

        // Show the 5 most recent updates
        data.slice(0, 5).forEach(update => {
            // Determine styling based on type
            let colorClass = 'plan-update'; // Default Yellow
            let icon = 'ðŸ“¢';

            if (update.type === 'Price Change') {
                colorClass = 'price-change'; // Red
                icon = 'ðŸ’°';
            } else if (update.type === 'New Vendor') {
                colorClass = 'new-vendor'; // Green
                icon = 'âœ¨';
            }

            const card = document.createElement('div');
            card.className = `update-card ${colorClass}`;
            card.innerHTML = `
                <div class="update-meta">
                    <div class="badge">${update.vendor}</div>
                    <div style="margin-top:0.5rem; font-size:0.8rem; color:#666;">${update.date}</div>
                </div>
                <div class="update-content">
                    <h4>${icon} ${update.type}</h4>
                    <p>${update.details}</p>
                </div>
            `;
            container.appendChild(card);
        });
    }

    // FIX 3: Actually run the function when the page loads
    document.addEventListener('DOMContentLoaded', loadChangelog);
  </script>
</body>
</html>
